## Internal/core/src/expr

### 1. ItypeExpr.h

**文件功能**：  
定义了表达式（Expression）类型的接口和基类，描述了表达式树的结构和类型推断机制。为各种类型的表达式（如算术、逻辑、比较等）提供统一的接口。

**geo相关更改**：

- 新增或扩展了对 geo 类型（如 Geometry、GeoPoint、GeoPolygon 等）的类型枚举和类型推断支持。
- 在类型推断、表达式类型判断等逻辑中，增加了 geo 类型的分支处理。

**更改动因**：  
为了让表达式系统能够识别和处理地理空间数据类型，为后续 geo 相关表达式（如空间过滤、距离计算等）提供类型基础。

---

### 2. Expr.cpp

**文件功能**：  
实现了表达式的构造、类型推断、求值等核心逻辑。负责表达式树的遍历、执行和结果计算。

**geo相关更改**：

- 在表达式求值、类型推断、表达式构造等流程中，增加了对 geo 类型的处理分支。
- 支持 geo 字段的表达式节点（如 geo 字段的比较、空间关系判断等）。
- 可能集成了 geo 相关的第三方库（如 GDAL/OGR）用于实际的空间计算。

**更改动因**：  
使表达式系统能够原生支持 geo 字段的表达式计算，为 geo 查询、过滤等功能提供底层支撑。

---

### 3. GISFunctionFilterExpr.cpp / GISFunctionFilterExpr.h

**文件功能**：  
专门实现地理空间函数相关的表达式节点和过滤逻辑。定义和实现了如 ST_Contains、ST_Within、ST_Distance 等空间函数的表达式节点。

**geo相关更改**：

- 新增了 GISFunctionFilterExpr 类及其相关实现，专门用于 geo 字段的空间函数过滤。
- 实现了空间关系判断、空间距离计算等 geo 相关表达式的构造、类型推断和求值逻辑。
- 可能集成了 geo 库进行底层空间运算。

**更改动因**：  
为 Milvus 提供原生的地理空间查询能力，使用户可以在表达式中直接使用空间函数进行过滤和检索。

---

## internal/core/src/exec/expression

### 主要文件（如 Expr.h/cpp, TermExpr.h/cpp, CompareExpr.h/cpp 等）

**文件功能**：

- 定义和实现了表达式的执行器（Executor），负责在数据扫描、过滤等场景下高效执行表达式。
- 包括通用表达式、比较表达式、逻辑表达式、Term（in-list）表达式等。

**geo相关更改**：

- 在表达式执行器中，增加了对 geo 类型字段的支持，使其能够正确处理 geo 字段的比较、空间关系判断等。
- 新增或扩展了 geo 相关表达式（如空间函数表达式）的执行逻辑。
- 在表达式分发、类型判断、执行流程等关键路径中，增加了 geo 类型的分支和处理。

**更改动因**：  
确保 geo 字段在表达式执行阶段能够被正确处理，实现 geo 查询的高效过滤和计算，提升地理空间检索的能力和性能。

---

## 总结

- **每个文件的功能**：expr 目录下文件负责表达式的定义、类型推断和求值，exec/expression 目录下文件负责表达式的高效执行。
- **geo 支持的新增/修改**：主要体现在类型系统、表达式节点、空间函数、执行器等各层面，均增加了对 geo 类型的识别、推断、构造和执行支持。
- **更改动因**：核心目的是让 Milvus 能够原生支持地理空间数据的表达式过滤和空间查询，满足地理空间检索场景的需求，提升产品竞争力。