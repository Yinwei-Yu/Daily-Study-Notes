ä»¥ä¸‹æ˜¯å…³äº Protocol Buffers ä¸­ **ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä½œä¸ºå­—æ®µç±»å‹**ã€**å¯¼å…¥å®šä¹‰** å’Œ **åµŒå¥—ç±»å‹** çš„ç¬”è®°æ•´ç†ï¼š

---

### ğŸ“Œ 1. ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä½œä¸ºå­—æ®µç±»å‹

ä½ å¯ä»¥åœ¨æ¶ˆæ¯ä¸­åµŒå¥—å…¶ä»–æ¶ˆæ¯ç±»å‹ä½œä¸ºå­—æ®µã€‚ä¾‹å¦‚ï¼š

```proto
message SearchResponse {
  repeated Result results = 1;
}

message Result {
  string url = 1;
  string title = 2;
  repeated string snippets = 3;
}
```

è¯´æ˜ï¼š

- `SearchResponse` åŒ…å«ä¸€ä¸ªå­—æ®µ `results`ï¼Œç±»å‹ä¸º `repeated Result`ã€‚
    
- `Result` æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„æ¶ˆæ¯ç±»å‹ã€‚
    
- `repeated` è¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥åŒ…å« 0 ä¸ªæˆ–å¤šä¸ª `Result` å®ä¾‹ã€‚
    

---

### ğŸ“Œ 2. å¯¼å…¥å®šä¹‰ï¼ˆImporting Definitionsï¼‰

å¦‚æœæƒ³è¦åœ¨ä¸€ä¸ª `.proto` æ–‡ä»¶ä¸­ä½¿ç”¨å¦ä¸€ä¸ª `.proto` ä¸­å®šä¹‰çš„ç±»å‹ï¼Œéœ€è¦ä½¿ç”¨ `import`ï¼š

```proto
import "myproject/other_protos.proto";
```

è¯´æ˜ï¼š

- è¢«å¯¼å…¥çš„ `.proto` æ–‡ä»¶å¯ä»¥æä¾›æšä¸¾ã€æ¶ˆæ¯ç±»å‹ç­‰ä¾›å½“å‰æ–‡ä»¶å¼•ç”¨ã€‚
    
- åªèƒ½è®¿é—®ç›´æ¥å¯¼å…¥çš„ `.proto` æ–‡ä»¶ä¸­çš„å®šä¹‰ã€‚
    

#### âœ… `import public`

ç”¨äºè½¬å‘å¯¼å…¥ï¼Œä½¿é—´æ¥å¯¼å…¥çš„æ–‡ä»¶å¯è§ï¼š

```proto
// old.proto
import public "new.proto";

// client.proto
import "old.proto"; // å¯ä»¥è®¿é—® old.proto å’Œ new.proto ä¸­çš„å®šä¹‰ï¼Œä½†ä¸èƒ½è®¿é—® old.proto ä¸­ import çš„é-public æ–‡ä»¶
```

**ä½¿ç”¨åœºæ™¯**ï¼š

- æ–‡ä»¶è¿ç§»æ—¶ï¼Œä¸éœ€è¦ä¿®æ”¹æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œåªéœ€è¦æ›¿æ¢åŸå§‹ä½ç½®çš„æ–‡ä»¶ä¸ºè½¬å‘ä»£ç†ã€‚
    
- å¯¹ Java ç‰¹åˆ«æœ‰ç”¨ï¼ˆéœ€è¦è®¾ç½® `java_multiple_files = true`ï¼‰ã€‚
    

> âš ï¸ æ³¨æ„ï¼šè¯¥æœºåˆ¶åœ¨ Kotlinã€TypeScriptã€JavaScriptã€GCLã€æŸäº› C++ å·¥å…·é“¾ä¸­ä¸å¯ç”¨ã€‚

---

### ğŸ“Œ 3. proto2 ä¸ proto3 çš„äº’æ“ä½œæ€§

- å¯ä»¥åœ¨ proto3 ä¸­å¼•å…¥ proto2 å®šä¹‰çš„ message ç±»å‹ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚
    
- ä½† **proto2 çš„æšä¸¾ä¸èƒ½ç›´æ¥ç”¨äº proto3 è¯­æ³•ä¸­å­—æ®µå®šä¹‰**ï¼ˆå°½ç®¡å¯¼å…¥çš„ proto2 message å¯ä»¥é—´æ¥ä½¿ç”¨å…¶ enumï¼‰ã€‚
    

---

### ğŸ“Œ 4. åµŒå¥—ç±»å‹ï¼ˆNested Message Typesï¼‰

æ¶ˆæ¯ç±»å‹å¯ä»¥å®šä¹‰åœ¨å…¶ä»–æ¶ˆæ¯ç±»å‹çš„å†…éƒ¨ï¼Œé€‚åˆç”¨äºå±€éƒ¨ä½œç”¨åŸŸã€ç»“æ„æ¸…æ™°çš„åœºæ™¯ï¼š

```proto
message SearchResponse {
  message Result {
    string url = 1;
    string title = 2;
    repeated string snippets = 3;
  }
  repeated Result results = 1;
}
```

ä½¿ç”¨åµŒå¥—ç±»å‹æ—¶ï¼Œå¤–éƒ¨å¼•ç”¨éœ€è¦ä½¿ç”¨å…¨é™å®šåï¼š

```proto
message SomeOtherMessage {
  SearchResponse.Result result = 1;
}
```

åµŒå¥—å±‚çº§ä¸é™ï¼Œä½†åº”é¿å…è¿‡åº¦åµŒå¥—ï¼Œä¿æŒå¯è¯»æ€§ï¼š

```proto
message Outer {
  message MiddleAA {
    message Inner {
      int64 ival = 1;
      bool booly = 2;
    }
  }

  message MiddleBB {
    message Inner {
      int32 ival = 1;
      bool booly = 2;
    }
  }
}
```

è¯´æ˜ï¼š

- `Outer.MiddleAA.Inner` å’Œ `Outer.MiddleBB.Inner` æ˜¯ä¸¤ä¸ªäº’ä¸ç›¸å¹²çš„ç±»å‹ï¼Œå³ä½¿å®ƒä»¬åå­—ç›¸åŒã€‚
    

---

### ğŸ“Œ 5. æ–‡ä»¶æœç´¢è·¯å¾„ä¸ proto_path

ç¼–è¯‘ `.proto` æ–‡ä»¶æ—¶ï¼Œå¯¼å…¥è·¯å¾„åŸºäº `--proto_path` å‚æ•°ï¼š

```bash
protoc --proto_path=src_dir myproto.proto
```

- å¦‚æœæ²¡æœ‰è®¾ç½® `--proto_path`ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•ã€‚
    
- é€šå¸¸å°†å…¶è®¾ç½®ä¸ºé¡¹ç›®æ ¹ç›®å½•ï¼Œå¹¶ä½¿ç”¨å®Œæ•´è·¯å¾„å¯¼å…¥ã€‚
    

---

### âœ… å°ç»“

|åŠŸèƒ½|è¯´æ˜|
|---|---|
|åµŒå¥—æ¶ˆæ¯ç±»å‹|é€‚åˆå±€éƒ¨ä½¿ç”¨ï¼Œå¯é€šè¿‡ `Parent.Type` å¼•ç”¨|
|å¯¼å…¥å®šä¹‰|ä½¿ç”¨ `import` å¼•ç”¨å…¶ä»– `.proto` ä¸­çš„å®šä¹‰|
|import public|å…è®¸å¯¼å…¥é“¾ä¸­çš„é—´æ¥å¯è§æ€§ï¼Œä¾¿äºæ¨¡å—è¿ç§»|
|proto2/3 äº’æ“ä½œ|å¯ç›¸äº’å¼•ç”¨æ¶ˆæ¯ï¼Œä½† enum æœ‰å…¼å®¹æ€§é™åˆ¶|
|åµŒå¥—ç±»å‹ä½œç”¨åŸŸ|åµŒå¥—è¶Šæ·±ï¼Œç±»å‹è¶Šå±€éƒ¨ï¼Œä½†æ³¨æ„é¿å…å‘½åå†²çª|
|æœç´¢è·¯å¾„|ä½¿ç”¨ `--proto_path` é…ç½®å¯¼å…¥è·¯å¾„|

---

è¿™éƒ¨åˆ†å†…å®¹å¸®åŠ©ä½ ç»„ç»‡ `.proto` æ–‡ä»¶ç»“æ„ï¼Œå®ç°ä»£ç å¤ç”¨ä¸æ¨¡å—æ‹†åˆ†ï¼Œæ˜¯å¤§å‹é¡¹ç›®ä½¿ç”¨ Protocol Buffers çš„åŸºç¡€å·¥å…·ã€‚