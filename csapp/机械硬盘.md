# 磁盘存储

从磁盘上读取数据比DRAM慢了10万倍,比SRAM慢了100万倍

本节关键词:
> 磁盘构造
> 磁盘容量
> 磁盘操作
> 逻辑磁盘块
> 连接IO设备
> 访问磁盘

## 磁盘构造

磁盘由盘片构成,每个盘片有两个表面,表面覆盖磁性记录材料,盘片中央有一个主轴,盘片绕主轴以5400-15000RPM进行旋转.磁盘包括多个盘片,封装在一个密封的容器中

下面是一个经典的磁盘表面的结构:[[csapp-zh-book#^9bijlmulj0e|一个盘片的视图]]


![[Pasted image 20240815193644.png]]

磁盘由多个堆叠在一起的盘片组成,封装在一个密封的包装里,称为磁盘驱动器,旋转磁盘,磁盘.

一个盘片由两个表面,每个表面有许多同心圆,这些同心圆是磁道,每个磁道被划分为一系列扇区,每个扇区之间有间隔,间隔中不存储数据

在整个磁盘中,距主轴距离相等的磁道组成的集合称为柱面

## 磁盘容量

[[csapp-zh-book#^vbc3f2clvmi|技术因素]]:

- 记录密度:磁道一定长度的段中可以放入的位数
- 磁道密度:从盘片中心出发半径一英寸的段内可以有的磁道数
- 面密度:上述两个参数的乘积

可以想象,越往外每个扇区之间的间隔越大,解决方式是[[csapp-zh-book#^ylinil2a5mk|多区记录 ]],柱面的集合被分割成不相交的子集,每个子集包含连续的柱面,每个区中的柱面都包含数量相同的扇区,每个区中的扇区数量取决于该区中最靠近主轴的磁道的扇区数.

下面是磁盘容量的计算公式:
[[csapp-zh-book#^ps5msmca02|磁盘的容量]]

## 磁盘操作

磁盘用读写头来读写存储在磁性表面的位,读写头一端连接在传动臂,一端可定位在任何磁道上.

每个盘面都有一个独立的读写头,任何时刻所有的读写头都位于相同的柱面上

![[Pasted image 20240815194719.png]]

对扇区的访问时间主要取决于三个因素:
- 寻道时间:移动传动臂到指定磁道所需的时间
- 旋转时间:目的磁道的目的扇区旋转到读写头下的时间,最差是1/RPM
- 传送时间:驱动器读或者写该扇区的时间

根据一个书中的[[csapp-zh-book#^ff16jiwamrj|例子]]:

- 访问一个扇区的第一个字节需要很长时间,而访问之后的字节几乎不花时间
- 寻道时间和旋转延迟大致相等,所以可以使用寻道时间 * 2来估计磁盘访问时间

## 逻辑磁盘块

磁盘将构造呈现为一个有B个扇区大小的逻辑块的序列,编号0...B-1

磁盘中有一个控制设备称为**磁盘控制器**,维护逻辑块号和实际磁盘扇区之间的关系

当操作系统读取数据时,发送给磁盘控制器一个逻辑块号,磁盘控制器将其翻译为(盘面,磁道,扇区)的三元组,再进行数据的传输

## 连接IO设备

像图形卡,显示器,鼠标,键盘等都是通过IO总线与cpu连接的

下面介绍P[[csapp-zh-book#^wj4jilf0e09|CI ]]总线:
例如:

- 通用串行总线
- 图形卡
- 主机总线适配器

关于IO总线的发展,可见:[[csapp-zh-book#^65uoevwv4yh|总线设计进展]]

## 访问磁盘

 cpu发出读信号后,磁盘读取数据,将数据发送给主存,然后向cpu发送中断信号
 
 [[csapp-zh-book#^8xbk9wbs3l|访问磁盘]]

